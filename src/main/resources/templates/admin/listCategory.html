<!DOCTYPE html>
<html xmlns:th="http://www.thymleaf.org">
<head th:include="include/admin/adminHeader::html('分类管理')">
<meta charset="UTF-8">
</head>
<body>
<div th:replace="include/admin/adminNavigator::html"></div>

<script>
	$(function(){
		var data4Vue={
			uri:"categories",
			beans:[],
			bean:{id:0,name:'',description:''},
			pagination:{},
			file:null,
		};
		
		var vue = new Vue({
			el:"#workingArea",
			data:data4Vue,
			
			mounted:function(){
				this.list(0);
			},
			
			methods:{
				list:function(start){
					var url = this.uri+"?start="+start;
					axios.get(url).then(function(response){
						vue.pagination = response.data;
						vue.beans = response.data.content;
						console.log("pagination");
						console.log(vue.pagination);
						console.log("beans");
						console.log(vue.beans);
					});
				},//list()
				
				add:function(){
					if(checkEmpty(this.bean.name,"分类名称")){
						return;
					}
					if(checkEmpty(this.bean.description,"分类描述")){
						return;
					}
					if(checkEmpty(this.file,"分类图片")){
						return;
					}
					
					var url = this.uri;
					var formData = new FormData();
					formData.append("name",this.bean.name);
					formData.append("description",this.bean.description);
					formData.append("image",this.file);
					axios.post(url,formData).then(function(response){
						vue.list(0);
					});
				},//add()
				
				deleteBean:function(id){
					if(!checkDeleteLink()){
						return;
					}
					
					var url = this.uri+"/"+id;
					axios.delete(url).then(function(response){
						vue.list(0);
					});
				},
				
                getFile: function (event) {
                    this.file = event.target.files[0];
                    console.log("getFile方法被调用："+this.file);
                },//getFile()				
				
				jump:function(page){
					jump(page,vue);
				},
				
				
				
			},//methods()
			
		 computed:{
            	firstPage:function(){
            		console.log("computed:firstPage()");
            		//alert(vue.pagination);
            		//console.log("computed:firstPage:");
            		//console.log("pagination:"+vue.pagination);
            		//console.log(vue.paginaton.number);
            		return {
            			disabled:vue.pagination.first
            		}	
            	}
            }//computed:
			
		});
		
	});
</script>


<div id="workingArea">
    <h1 class="label label-info" >分类管理</h1>
    <br>
    <br>
	<div class="listTableDataDiv">
		<table class="table table-striped table-hover table-condensed table-bordered">
			<thead>
				<tr class="success">
				<th>ID</th>
                <th>图片</th>
                <th>分类名称</th>
                <th>属性管理</th>
                <th>产品管理</th>
                <th>编辑</th>
                <th>删除</th>	
                </tr>		
			</thead>
			
			<tbody>
				<tr v-for="bean in beans">
					<td>{{bean.id}}</td>
					<td>
					<img height="40px" :src="'img/category/'+bean.id+'.jpg'">
					</td>
					<td>{{bean.name}}</td>
					
					<td>
					<a :href="'admin_property_list?cid='+bean.id">
					<span class="glyphicon glyphicon-th-list"></span>
					</a>
					</td>
					
					<td>
					<a :href="'admin_product_list?cid=' + bean.id ">
					<span class="glyphicon glyphicon-shopping-cart"></span></a>
					</td>
					
					<td>
					<a :href="'admin_category_edit?id=' + bean.id ">
					<span class="glyphicon glyphicon-edit"></span></a>
					</td>
					
					<td>
					<a href="#nowhere"  @click="deleteBean(bean.id)">
					<span class="   glyphicon glyphicon-trash"></span></a>
					</td>
					
				</tr>
			
			</tbody>
		</table>
	
	</div><!-- listTableDataDiv -->
	
	<div th:replace="include/admin/adminPage::html"></div>
	
	<div class="panel panel-warning addDiv">
		<div class="panel-heading">新增分类</div>
		<div class="panel-body">
			<table class="addTable">
				<tr>
					<td>分类名称</td>
					<td>
					<input type="text" class="form-control" @keyup.enter="add"
						v-model.trim="bean.name">
					</td>
				</tr>
                <td>分类描述</td>
                <td><input @keyup.enter="add" v-model.trim="bean.description" type="text" class="form-control"></td>
                </tr>
                <tr>
                    <td>分类图片</td>
                    <td>
					<input id="categoryPic" type="file" name="image" accept="image/*"
					@change="getFile($event)">
                    </td>
                </tr>
                
                <tr class="submitTR" >
                	<td colspan="2" align="center">
                		<a href="#nowhere"  @click="add" class="btn btn-success">提交</a>
                	</td>
                </tr>               				
			
			</table>
		</div><!-- panel-body -->
	</div><!-- addDiv -->
	

</div><!-- workingArea -->

<div th:replace="include/admin/adminFooter::html" ></div>

</body>
</html>