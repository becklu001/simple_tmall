<!DOCTYPE html>
<html xmlns:th="http://www.thymleaf.org">
<head th:include="include/admin/adminHeader::html('属性管理')">
<meta charset="UTF-8">
</head>
<body>
<div th:replace="include/admin/adminNavigator::html"></div>

<script>
	$(function(){
		var data4Vue = {
				uri:"properties",
				category:'',
				bean:{id:0,name:'',category:{id:0}},
				beans:[],
				pagination:{},
		};
		
	function getCid(){
		console.log("getCid():)");
		var search = location.search;
		var cid = search.substr(5);
		return cid;
	}
	
	var cid = getCid();
		
	var vue = new Vue({
		el:"#workingArea",
		data:data4Vue,
		
		mounted:function(){
//			this.cid = getCid();
			this.getCategory(cid);
			this.list(0);
		},
		
		methods:{
			list:function(start){
				console.log(cid);
				var url = "categories/"+cid+"/"+this.uri+"?start="+start;
				axios.get(url).then(function(response){
					vue.pagination = response.data;
					vue.beans = response.data.content;
					console.log("vue.pagination:");
					console.log(vue.pagination);
				});
			},//list(start)
			
			add:function(){
				if(checkEmpty(this.bean.name,"属性名称")){
					return;
				}
				var url = this.uri;
				this.bean.category.id = cid;
				axios.post(url,vue.bean).then(function(response){
					vue.list(0);
				});
			},
			
			deleteBean:function(id){
				if(!checkDeleteLink()){
					return;
				}
				var url = this.uri+"/"+id;
				axios.delete(url).then(function(response){
					if(0!=response.data.length){
						alert(response.data);
					}else{
						vue.list(0);
					}
				});
			},
			
			getCategory:function(cid){
				var url = "categories/"+cid;
				axios.get(url).then(function(response){
					vue.category = response.data;
				});
			},//getCategory
			
			jump:function(page){
				jump(page,vue);
			},
			
			
			
/* 			getCid:function(){
				console.log("getCid():");
				var search = location.search;
				var cid = search.substr(5);
				return cid;
			},//getCid */
			
		},//methods
		
		computed:{
			firstPage:function(){
				return{
					disabled:vue.pagination.first
				}
			}
		},//computed
	});
		
		
	});

</script>


<div id="workingArea">
	<ol class="breadcrumb">
		<li><a href="admin_category_list">所有分类</a></li>
		<li><a :href="'admin_property_list?cid='+category.id">
		{{category.name}}</a></li>
		<li class="active">属性管理</li>
	</ol>

	<div class="listDataTableDiv">
		<table class="table table-hover table-bordered table-condensed table-striped">
			<thead>
				<tr class="success">
					<th>ID</th>
					<th>CID</th>
					<th>属性名称</th>
					<th>编辑</th>
					<th>删除</th>
				</tr>
			</thead>
			
			<tbody>
				<tr v-for="bean in beans">
					<td>{{bean.id}}</td>
					<td>{{category.id}}</td>
					<td>{{bean.name}}</td>
					
					<td>
					<a :href="'admin_property_edit?id='+bean.id">
					<span class="glyphicon glyphicon-edit"></span>
					</a>
					</td>
					
					<td>
					<a href="#nowhere" @click=deleteBean(bean.id)>
					<span class="   glyphicon glyphicon-trash"></span>
					</a>
					</td>
				</tr>
			
			</tbody>
		</table>
	
	</div><!-- listDataTableDiv -->
	
	<div th:replace="include/admin/adminPage::html"></div>
	
	<div class="addDiv panel panel-warning">
		<div class="panel-heading">新增属性</div>
		<div class="panel-body">
			<table class="addTable">
				<tr>
					<td>属性名称</td>
					<td>
					<input type="text" class="form-control" 
					@keyup-enter="add" v-model.trim="bean.name">
					</td>
				</tr>
				
				<tr class="submitTR">
					<td colspan="2" align="center">
						<a href="#nowhere" class="btn btn-success"
						@click="add">提交</a>
					</td>		
				</tr>
			</table><!-- addTable -->
		</div>
	</div><!-- addDiv -->

</div><!-- workingArea -->

<div th:replace="include/admin/adminFooter::html"></div>
</body>
</html>